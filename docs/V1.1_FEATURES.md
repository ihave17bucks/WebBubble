# WebBubble v1.1 - Complete Feature Guide ü´ß

## File Extension

WebBubble programs use the **`.bub`** extension! ü´ß

```bash
# Create a file
touch api.bub

# Run it
webbubble api.bub
```

Just like Python uses `.py` and JavaScript uses `.js`, WebBubble uses `.bub`!

---

## New Features

- ‚úÖ **Route Parameters** - `/users/:id`
- ‚úÖ **Control Flow** - if/else, while loops
- ‚úÖ **Functions** - Define and call functions
- ‚úÖ **SQLite Database** - Built-in database support

---

## 1. Route Parameters üéØ

### Basic Usage

```bubble
route "/users/:id" {
    // :id is automatically available
    response "User ID: " + id
}
```

### Multiple Parameters

```bubble
route "/posts/:postId/comments/:commentId" {
    response "Post " + postId + ", Comment " + commentId
}
```

### With Database

```bubble
route "/api/users/:id" {
    db = database.connect("app.db")
    user = db.queryOne("SELECT * FROM users WHERE id = ?", id)
    response json { user }
}
```

### Pattern Matching

- `/users/:id` matches `/users/123`
- `/posts/:slug/edit` matches `/posts/hello-world/edit`
- Parameters are automatically converted to variables
- Access with the parameter name (without `:`)

---

## 2. Control Flow - If/Else üîÄ

### Basic If

```bubble
route "/check/:age" {
    ageNum = age + 0  // Convert to number
    
    if ageNum >= 18 {
        status = "adult"
    }
    
    response status
}
```

### If/Else

```bubble
if score >= 90 {
    grade = "A"
} else {
    grade = "F"
}
```

### If/Else If/Else

```bubble
if score >= 90 {
    grade = "A"
} else if score >= 80 {
    grade = "B"
} else if score >= 70 {
    grade = "C"
} else {
    grade = "F"
}
```

### Conditions

Supported comparison operators:
- `==` - Equal
- `!=` - Not equal
- `<` - Less than
- `>` - Greater than
- `<=` - Less than or equal
- `>=` - Greater than or equal

Supported logical operators:
- `&&` - AND
- `||` - OR

```bubble
if age >= 18 && hasLicense {
    response "Can drive"
}

if isAdmin || isModerator {
    response "Has permissions"
}
```

---

## 3. Control Flow - While Loops üîÅ

### Basic While

```bubble
count = 0
while count < 10 {
    print(count)
    count = count + 1
}
```

### With Break Condition

```bubble
route "/api/countdown/:start" {
    n = start + 0
    result = ""
    
    while n > 0 {
        result = result + n + " "
        n = n - 1
    }
    
    response result + "Liftoff!"
}
```

### Iterating Over Data

```bubble
route "/api/process" {
    db = database.connect("app.db")
    users = db.query("SELECT * FROM users")
    
    processed = 0
    while processed < users.length {
        user = users[processed]
        // Process user
        processed = processed + 1
    }
    
    response "Processed " + processed + " users"
}
```

---

## 4. Functions üîß

### Defining Functions

```bubble
function greet(name) {
    return "Hello, " + name + "!"
}

function add(a, b) {
    return a + b
}

function isAdult(age) {
    if age >= 18 {
        return true
    }
    return false
}
```

### Calling Functions

```bubble
route "/api/greet/:name" {
    message = greet(name)
    response message
}

route "/api/sum/:a/:b" {
    result = add(a, b)
    response "Sum: " + result
}
```

### Recursive Functions

```bubble
function factorial(n) {
    if n <= 1 {
        return 1
    }
    return n * factorial(n - 1)
}

function fibonacci(n) {
    if n <= 1 {
        return n
    }
    return fibonacci(n - 1) + fibonacci(n - 2)
}
```

### Multiple Parameters

```bubble
function calculateTotal(price, quantity, taxRate) {
    subtotal = price * quantity
    tax = subtotal * taxRate
    return subtotal + tax
}

route "/api/calculate" {
    total = calculateTotal(99.99, 3, 0.08)
    response "Total: $" + total
}
```

---

## 5. SQLite Database üóÑÔ∏è

### Connecting

```bubble
db = database.connect("myapp.db")
```

The database file is created automatically if it doesn't exist.

### Querying Multiple Rows

```bubble
route "/api/users" {
    db = database.connect("app.db")
    users = db.query("SELECT * FROM users")
    response json { users }
}
```

### Querying Single Row

```bubble
route "/api/users/:id" {
    db = database.connect("app.db")
    user = db.queryOne("SELECT * FROM users WHERE id = ?", id)
    
    if user {
        response json { user }
    } else {
        response status=404 "Not found"
    }
}
```

### Parameterized Queries

Always use `?` placeholders for security:

```bubble
// ‚úÖ GOOD - Prevents SQL injection
user = db.queryOne("SELECT * FROM users WHERE email = ?", email)

// ‚ùå BAD - Vulnerable to SQL injection
user = db.queryOne("SELECT * FROM users WHERE email = '" + email + "'")
```

### Inserting Data

```bubble
route "POST /api/users" {
    db = database.connect("app.db")
    
    name = request.body.name
    email = request.body.email
    
    result = db.execute(
        "INSERT INTO users (name, email) VALUES (?, ?)",
        name, email
    )
    
    response status=201 json {
        id: result.lastInsertId,
        name,
        email
    }
}
```

### Updating Data

```bubble
route "PUT /api/users/:id" {
    db = database.connect("app.db")
    
    name = request.body.name
    
    result = db.execute(
        "UPDATE users SET name = ? WHERE id = ?",
        name, id
    )
    
    response json {
        updated: result.changes,
        message: "User updated"
    }
}
```

### Deleting Data

```bubble
route "DELETE /api/users/:id" {
    db = database.connect("app.db")
    
    result = db.execute("DELETE FROM users WHERE id = ?", id)
    
    if result.changes > 0 {
        response "User deleted"
    } else {
        response status=404 "User not found"
    }
}
```

### Creating Tables

```bubble
route "/api/setup" {
    db = database.connect("app.db")
    
    db.execute(`
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            email TEXT UNIQUE NOT NULL,
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP
        )
    `)
    
    db.execute(`
        CREATE TABLE IF NOT EXISTS posts (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            title TEXT NOT NULL,
            content TEXT,
            author_id INTEGER,
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (author_id) REFERENCES users(id)
        )
    `)
    
    response "Database initialized"
}
```

### Transactions

```bubble
route "POST /api/transfer" {
    db = database.connect("bank.db")
    
    fromId = request.body.fromId
    toId = request.body.toId
    amount = request.body.amount
    
    // Begin transaction
    db.execute("BEGIN TRANSACTION")
    
    // Debit from account
    db.execute(
        "UPDATE accounts SET balance = balance - ? WHERE id = ?",
        amount, fromId
    )
    
    // Credit to account
    db.execute(
        "UPDATE accounts SET balance = balance + ? WHERE id = ?",
        amount, toId
    )
    
    // Commit transaction
    db.execute("COMMIT")
    
    response "Transfer complete"
}
```

---

## 6. Complete Examples üöÄ

### User Authentication API

```bubble
function hashPassword(password) {
    // Use built-in hashing
    return crypto.hash("sha256", password)
}

route "POST /api/register" {
    db = database.connect("app.db")
    
    email = request.body.email
    password = request.body.password
    
    // Check if user exists
    existing = db.queryOne("SELECT * FROM users WHERE email = ?", email)
    
    if existing {
        response status=400 json {
            error: "Email already registered"
        }
    } else {
        hashed = hashPassword(password)
        
        result = db.execute(
            "INSERT INTO users (email, password) VALUES (?, ?)",
            email, hashed
        )
        
        response status=201 json {
            id: result.lastInsertId,
            message: "User registered"
        }
    }
}

route "POST /api/login" {
    db = database.connect("app.db")
    
    email = request.body.email
    password = request.body.password
    
    user = db.queryOne("SELECT * FROM users WHERE email = ?", email)
    
    if user && user.password == hashPassword(password) {
        token = jwt.sign({ userId: user.id })
        
        response json {
            token,
            userId: user.id
        }
    } else {
        response status=401 json {
            error: "Invalid credentials"
        }
    }
}
```

### Blog API with Pagination

```bubble
route "/api/posts" {
    db = database.connect("blog.db")
    
    // Get pagination parameters
    page = request.query.page || 1
    limit = request.query.limit || 10
    
    offset = (page - 1) * limit
    
    posts = db.query(
        "SELECT * FROM posts ORDER BY created_at DESC LIMIT ? OFFSET ?",
        limit, offset
    )
    
    total = db.queryOne("SELECT COUNT(*) as count FROM posts")
    
    response json {
        posts,
        pagination: {
            page,
            limit,
            total: total.count,
            pages: (total.count + limit - 1) / limit
        }
    }
}
```

### Search with Filters

```bubble
route "/api/search" {
    db = database.connect("app.db")
    
    query = request.query.q || ""
    category = request.query.category || ""
    minPrice = request.query.minPrice || 0
    maxPrice = request.query.maxPrice || 99999
    
    sql = "SELECT * FROM products WHERE 1=1"
    params = []
    
    if query {
        sql = sql + " AND name LIKE ?"
        params.push("%" + query + "%")
    }
    
    if category {
        sql = sql + " AND category = ?"
        params.push(category)
    }
    
    sql = sql + " AND price >= ? AND price <= ?"
    params.push(minPrice, maxPrice)
    
    results = db.query(sql, params)
    
    response json { results }
}
```

---

## Performance Tips ‚ö°

### 1. Connection Pooling

WebBubble automatically pools database connections. Don't worry about closing connections - they're reused.

### 2. Prepared Statements

Always use parameterized queries (`?`) - they're automatically prepared and cached.

### 3. Indexes

```bubble
db.execute("CREATE INDEX idx_users_email ON users(email)")
db.execute("CREATE INDEX idx_posts_author ON posts(author_id)")
```

### 4. Batch Inserts

```bubble
db.execute("BEGIN TRANSACTION")

i = 0
while i < users.length {
    user = users[i]
    db.execute("INSERT INTO users (name, email) VALUES (?, ?)", user.name, user.email)
    i = i + 1
}

db.execute("COMMIT")
```

---

## What's Next? üîÆ

Coming in v1.2:
- ‚ú® For loops (`for i in items { }`)
- üîå Middleware
- üì¶ Import/export modules
- üåê HTTP client requests
- üìß Email sending
- üîê Built-in authentication
- üìù Template engine

---

**WebBubble v1.1 - Now production-ready!** ü´ßüöÄ
